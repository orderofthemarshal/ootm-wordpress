FROM docker.io/fedora:43

# Allow caller to set UID/GID at build time (default 1000).
ARG USER_UID=1000
ARG USER_GID=1000

### System dependencies
RUN dnf install -y \
  bash-completion \
  composer \
  curl \
  file \
  git \
  gnupg2 \
  hostname \
  ImageMagick \
  iputils \
  jq \
  man-db \
  ncurses \
  nginx \
  npm \
  openssh openssh-clients openssh-server \
  php \
  php-fpm \
  php-mysqlnd \
  podman podman-docker \
  python3 \
  sudo \
  unzip \
  vim \
  wget \
  xz \
  zip

# Extra bashrc, paths, etc
COPY ./bashrc-load-dir.sh /etc/bashrc-load-dir.sh
COPY ./bashrc.d /etc/.bashrc.d
RUN printf '\n\
  if [ -d /etc/.bashrc.d ]; then\n\
  for rc in /etc/.bashrc.d/*; do\n\
  if [ -f "$rc" ]; then\n\
  . "$rc"\n\
  fi\n\
  done\n\
  fi\n\
  \n' >> /etc/bashrc

# Set up 'developer' user, no password, with sudo
# Align container user with host UID/GID (1000) so bind mounts are writable.
RUN groupadd -g ${USER_GID} developer \
  && useradd -m -u ${USER_UID} -g ${USER_GID} -G wheel developer
RUN printf '\n\ndeveloper ALL=(ALL) NOPASSWD: ALL\n' >> /etc/sudoers
RUN chown developer:developer -R /home/developer
USER developer
